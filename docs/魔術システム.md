# 魔法システム仕様書

## 1\. システム概要

MAGISYSTEMの魔法システムは、プレイヤーが**4属性の魔力**（火、水、空、土）を蓄積し、**魔法陣**を構築して様々な効果を発動するシステムです。

### 基本概念

  * **4属性の魔力**: 火（Fire）、水（Water）、空（Air）、土（Earth）
  * **魔力容量**: プレイヤーの**基本容量は100ポイント**（4属性合計）。**魔力蓄積機**を設置することで、さらに大規模な魔法を使用可能になります。
  * **魔法陣**: 特定のブロックパターンで構築され、魔力を消費して魔法を発動します。

-----

## 2\. 魔力システム

### 2.1 魔力管理

  * **基本容量**: 全属性合計で100ポイント（固定）。
  * **データ保存**: プレイヤーのダイナミックプロパティで永続的に保存されます。
  * **属性配分**: 獲得した魔力はその属性に固定され、変換はできません。

### 2.2 魔力獲得方法

魔力は以下の方法で獲得できます。

  * **行動による獲得**: 特定のゲーム内行動で複数の属性魔力を同時に獲得します。

| 行動       | 獲得魔力                                 |
| :--------- | :--------------------------------------- |
| かまど精錬 | 火+2、土+1                               |
| 水中移動   | 水+1/秒（継続）                          |
| エリトラ飛行 | 空+2/秒、火+0.5/秒                       |
| ブロック採掘 | 土+1、火+0.2（石系）                     |
| 農作物収穫 | 土+5、水+2                               |
| 骨粉使用   | 土+3、水+5、空+2                         |

  * **研究テーブルによる変換**: 専用ブロック「研究テーブル」でアイテムを消費し、魔力に変換します。

| アイテム例 | 獲得魔力                   |
| :--------- | :------------------------- |
| 土ブロック | 土+15、水+5                |
| 木材       | 土+5、火+2                 |
| レッドストーン | 火+15、空+8、土+5          |
| ダイヤモンド | 土+80、空+40、水+20        |
| ネザースター | 火+200、空+100、水+50、土+50 |

### 2.3 魔力蓄積機システム

魔力蓄積機は設置型のブロックで、魔力を独立して貯蔵します。各属性専用の蓄積機が存在し、対応する属性の魔力のみを貯蔵できます。魔力パイプで接続して使用します。破壊時は貯蔵されている魔力量を保持したままアイテム化され、再設置時に魔力が復元されます。

**操作方法**：
- **右クリック**：蓄積機から10魔力をプレイヤーに移動（プレイヤーの容量上限まで）
- **Shift+右クリック**：プレイヤーから10魔力を蓄積機に移動（蓄積機の容量上限まで）
-----

## 3\. 魔法陣システム

### 3.1 魔法陣の構造

魔法陣は円形のブロックパターンで構成され、階層によって規模と複雑さが異なります。

| 構成   | サイズ（直径） | 必要ブロック数 | 記述可能ブロック数（始点除く） | 主な用途             |
| :----- | :------------- | :------------- | :----------------------------- | :------------------- |
| **単層** | 5x5            | 12             | 11                             | 基本的な魔法         |
| **二重** | 11x11          | 36             | 38（内層11、外層27）           | 中級魔法、複合物処理 |
| **三重** | 17x17          | 72             | 81（内層11、中層27、外層43）   | 上級魔法、大規模効果 |
| **四重** | 23x23          | 120            | 148（内層11、中層1:27、中層2:43、外層67） | 超上級魔法、究極効果 |

**構造図の凡例**: 
```
z = シンボルブロック
b = 魔法基盤ブロック
```

### 単層構成 (5x5)

```
 zzz 
z   z
z b z
z   z
 zzz 
```

### 二重構成 (11x11)

```
    zzz    
  zz   zz  
 z       z 
 z  zzz  z 
z  z   z  z
z  z b z  z
z  z   z  z
 z  zzz  z 
 z       z 
  zz   zz  
    zzz    
```

### 三重構成 (17x17)

```
      zzzzz      
    zz     zz    
   z         z   
  z    zzz    z  
 z   zz   zz   z 
 z  z       z  z 
z   z  zzz  z   z
z  z  z   z  z  z
z  z  z b z  z  z
z  z  z   z  z  z
z   z  zzz  z   z
 z  z       z  z 
 z   zz   zz   z 
  z    zzz    z  
   z         z   
    zz     zz    
      zzzzz      
```

### 四重構成 (23x23)

```
         zzzzzzz         
       zz       zz       
     zz           zz     
    z               z    
   z      zzzzz      z   
  z     zz     zz     z  
  z    z         z    z  
 z    z    zzz    z    z 
 z   z   zz   zz   z   z 
z    z  z       z  z    z
z   z  z   zzz  z   z   z
z   z  z  z   z  z  z   z
z   z  z  z b z  z  z   z
z   z  z  z   z  z  z   z
z   z  z   zzz  z   z   z
z    z  z       z  z    z
 z   z   zz   zz   z   z 
 z    z    zzz    z    z 
  z    z         z    z  
  z     zz     zz     z  
   z      zzzzz      z   
    z               z    
     zz           zz     
       zz       zz       
         zzzzzzz         
```

### 3.2 魔法陣の構成要素

魔法陣は以下のシンボルブロックで構成されます。

### 基本シンボル (8種)

  * **始（始点）**: 魔法陣の起動ポイント。
  * **基（基礎）**: 構造を安定させる。
  * **火/水/空/土**: 各属性を表すシンボル。
  * **連（連結）**: 複数の魔法陣を接続するためのポイント。

### 機能シンボル (1種)

  * **強（強化）**: 効果を増幅させます。計算式は `$1 + (強化数 \times 0.3)$` で、最大2.5倍まで（強化シンボル5個）。

### モードシンボル (3種)

  * **分（分解）**: アイテムを魔力に変換します（アイテム入力が必要）。
  * **発（発現）**: 魔力を現象やエネルギーに変換し、魔法効果を発動します。
  * **工（加工）**: アイテムを別のアイテムに変換します（アイテム入力が必要）。

### 連結シンボル詳細

  * **機能**: 他の魔法陣のメインサークルまたは連結サークルとの接続に使用します。
  * **配置**: 連結1回につき、**3個セット**で配置します（例: `rrr`）。
      * メインサークル内: 外部への**出力ポート**として機能します。
      * 連結サークル内: メインからの**入力ポート**として機能し、始点シンボル (`s`) の代わりとして**1個**配置します。
  * **接続ルール**:
      * メインサークルの連結3個と連結先サークルの連結1個が**物理的に隣接**している必要があります。
      * 連結方向は東西南北自由に設定できます。
      * 連結シンボル間の間隔は図解パターン通りで、隙間なく配置します。

### 3.3 属性の複合効果

魔法陣内に配置された属性シンボルの組み合わせにより、複合効果が自動的に決定されます。
**注意**: 複合属性を使用するには、対応するレベルの魔法基盤ブロックが必要です。

### 2属性複合（特殊効果）- 魔法基盤ブロック Lv.2以上が必要

  * **水＋空**: 雷（電撃ダメージ、高速移動、電力生成）
  * **水＋土**: 生命（回復、成長促進、植物活性化）
  * **火＋土**: 溶岩（炎ダメージ、ブロック溶解、超高温加工）
  * **火＋空**: 陽炎（熱気流、視界歪み、乾燥効果）
  * **火＋水**: 爆発（爆発ダメージ、圧力破壊、高圧加工）
  * **空＋土**: 研磨（表面処理、精密加工、研磨効果）

### 3属性複合（高級特殊効果）- 魔法基盤ブロック Lv.3以上が必要

  * **火＋水＋空**: 嵐（継続雷撃、気象制御、広域電力網）
  * **火＋水＋土**: 治癒（強回復、状態異常治癒、地熱利用）
  * **火＋空＋土**: 焦熱（焦土化、極限乾燥、高温加工）
  * **水＋空＋土**: 繁茂（超成長、環境改変、生態系制御）

### 4属性複合（究極効果）- 魔法基盤ブロック Lv.4が必要

  * **火＋水＋空＋土**: 奈落（空間操作、次元移動、現実改変）

### 単一属性（基本効果）- 魔法基盤ブロック Lv.1以上が必要

  * **火のみ**: 炎ダメージ（燃焼、着火）
  * **水のみ**: 氷ダメージ（凍結、移動速度低下）
  * **空のみ**: 風ダメージ（ノックバック、浮遊）
  * **土のみ**: 物理ダメージ（鈍化、防御力低下）

合計13種類の複合効果が存在します。

### 3.4 始点・連結シンボルの配置ルール

1.  **単層魔法陣**: 東西南北いずれか1箇所に**始点シンボル**を1つ配置します。
2.  **多層魔法陣**: 全ての層の始点シンボルが東西南北のいずれか**一方向に一直線**に配置されます。
3.  **連結シンボル**:
      * メインサークルの**最外層**に**3個セット**で配置します。
      * 連結先サークルでは、**始点位置**に**1個**配置します（始点の代替）。
      * 複合連結時は段階的に配置します（例: 二重魔法陣から単層魔法陣へ連結）。
      * 連結シンボル間の間隔は図解パターン通りで、隙間なく直線に配置します。

-----

## 4\. 魔法発動システム

### 4.1 発現モードのパラメータ

**威力と範囲**は、発現シンボルと属性シンボルの配置によって設定されます。

  * **単一発現モード（発×1）**: 属性シンボルが威力と範囲に均等に配分されます。

    ```
    例: 雷効果（水+空）を12個配置
    配置: 始、発、水×6、空×6、基
    合計属性: 12 (水6、空6 → 雷6)
    威力: 3 (雷6の半分)
    範囲: 3 (雷6の半分)
    効果: 中威力・中範囲の雷撃
    ```

  * **連鎖発現モード（発→発）**: 1つ目の発現シンボルで威力を、2つ目の発現シンボルで範囲を設定できます。

    ```
    例: 雷効果（水+空）で威力と範囲を分離
    配置: 始、発、水×6、空×6、発、水×1、空×1
    1つ目の発現: 威力専用 (水6、空6 → 雷6)
    2つ目の発現: 範囲専用 (水1、空1 → 雷1)
    効果: 高威力・狭範囲の雷撃

    重要: 両方の発現で同じ属性種類（水・空）を使用する必要があります。
    ```

### 実例比較

| パターン       | 配置例                                         | 威力 | 範囲 | 効果例                                      |
| :------------- | :--------------------------------------------- | :--- | :--- | :------------------------------------------ |
| **単一発現** | `始、発、水×4、空×4、基×3`                  | 2    | 2    | 10ダメージ、射程4ブロック、半径2ブロックの雷撃 |
| **威力特化** | `始、発、水×6、空×6、発、水×1、空×1、基`    | 6    | 1    | 30ダメージ、射程1ブロック、単体雷撃         |
| **範囲特化** | `始、発、水×1、空×1、発、水×6、空×6、基`    | 1    | 6    | 5ダメージ、射程36ブロック、半径6ブロックの雷撃 |
| **エラー例** | `始、発、水×4、空×2、発、火×2、基×4`       | N/A  | N/A  | **エラー**: 属性不一致                      |

### 4.2 魔力消費

魔力消費はシンボルごとに設定されており、魔法陣の規模によって倍率がかかります。

### 基本消費量 (シンボル別)

  * **属性シンボル（火/水/空/土）**: 各1魔力（対応属性から消費）
  * **機能シンボル**:
      * **強化（強）**: 1魔力（強化対象の属性から消費）。効果倍率：`$(1 + 強化数 \times 0.5)$`、最大3.5倍（強化シンボル5個）。
  * **モードシンボル（分解/発現/加工）**: 使用する属性種ごとに1魔力（例: 雷（水+空）使用時は水1、空1消費）。
  * **システムシンボル（基礎/始点/連結）**: 0魔力

### サイズ倍率（累乗的増加）

  * **単層 (5x5)**: ×1（基本）
  * **二重 (11x11)**: ×3
  * **三重 (17x17)**: ×6
  * **四重 (23x23)**: ×10

### 魔力消費計算例

  * **単層魔法陣（雷）**: `始、発、雷（水+空）×4、基×1`
      * 消費: 発（水1+空1） + 水4 + 空4 = **水5、空5**
  * **三重魔法陣（ネザー加工）**: `始、工、ネザー（火+空+土）×15、基×4`
      * 基本消費: 工（火1+空1+土1） + 火15 + 空15 + 土15 = 48魔力
      * サイズ倍率: ×6
      * 総消費: 火96 + 空96 + 土96 = **288魔力**

### 強化システムのバランス設計

  * **純粋配置**: 魔力効率が最も良い（基準効率1.0）。
  * **強化活用**: やや高コストだが、スペース節約や魔力集中が可能。
  * **コスト差**: 強化1個（3魔力）は属性シンボル1個（2魔力）の1.5倍コスト。
  * **効果差**: 強化1個で0.5倍の効果増加に対し、属性シンボル1個は線形増加。

| 配置パターン | 属性数 | 強化数 | 効果倍率 | 総効果 | 魔力消費 | 効率※ | スロット |
| :----------- | :----- | :----- | :------- | :----- | :------- | :---- | :------- |
| 純粋×1      | 1      | 0      | 1.0      | 1.0    | 2        | 1.00  | 1        |
| 強化×1      | 1      | 1      | 1.5      | 1.5    | 5        | 0.60  | 2        |
| 混合1        | 2      | 1      | 1.5      | 3.0    | 9        | 0.67  | 3        |

*※効率 = 総効果 ÷ 魔力消費*

### 4.3 魔法発動プロセス

魔法陣の起動方法は、魔法出力装置、ワンド、直接起動の3種類があります。

#### 発動方法別の効率比較
| 発動方法 | 魔力効率 | 特徴 |
|---------|---------|------|
| 魔法出力装置 | **80%消費**（20%削減） | 最高効率・自動化対応・電力とパイプが必要 |
| ワンド発動 | **80%消費**（20%削減） | 高効率・即時発動・充電とプレイヤー魔力使用 |
| 直接起動 | 100%消費（標準） | シンプル・ブロック消費・プレイヤー魔力のみ使用 |

### 魔法出力装置発動

1.  **電力入力**: 装置に電力が供給される。
2.  **魔法陣起動**: 装置への電力入力で魔法陣が起動。
3.  **エンティティ魔法陣展開**: 起動した魔法陣がブロック上部にエンティティとして展開（複数ある場合は上方向に重なるように配置、間隔0.5ブロック）。
4.  **魔力・アイテム入力待機**: パイプ経由での魔力とアイテム入力を待機。
5.  **継続起動**: 電力が残っている間は起動状態を維持。
6.  **効果発動**: 魔力とアイテムが揃った瞬間に効果を発動。
7.  **自動終了**: 電力切れで魔法陣が自動終了（エンティティ消滅）。

<!-- end list -->

  * **注意**: 魔法出力装置は**並列処理**で動作します。
  * **効率ボーナス**: 魔法出力装置経由での魔法発動は**魔力消費が20%削減**されます（素手起動・ワンド発動と比較して高効率）。

### ワンド発動

1.  **対象選択**:
      * **発現モード**: 視線方向（右クリック）
      * **加工・分解モード**: 右クリックで対象ブロックを選択
2.  **充電チェック**: ワンドの耐久度が残っているかを確認（耐久度0では使用不可）。
3.  **魔力消費**: プレイヤーの保有魔力を可能な限り消費（**20%削減効率**適用）。
4.  **充電消費**: 魔法発動成功時にワンドの耐久度を1消費。
5.  **効果発動判定**:
      * 魔力不足: 効果発動失敗（魔力は消費済み、充電は消費されない）。
      * 魔力十分: 魔法効果を発動。
6.  **効果実行**: 
      * **発現モード**: 通常の魔法効果を実行
      * **加工モード**: 対象ブロックを加工完了後、ブロックを破壊して加工後のアイテムをドロップ
      * **分解モード**: 対象ブロックを魔力に変換後、ブロックを破壊

#### ワンド充電システム
- **充電表現**: 耐久度パラメータで充電を表現（耐久度 = 残り使用回数）
- **充電方法**: 魔力蓄積機に右クリックでワンドを充電（1回の充電で耐久度+10回復）
- **充電コスト**: 充電1回につき各属性10魔力を魔力蓄積機から消費
- **最大充電**: ワンドのレベルに応じて最大耐久度が決定
- **充電切れ**: 耐久度0では魔法発動不可（エラーメッセージ表示）

### 直接起動 (素手クリック)

1.  **魔法陣起動**: 魔法基盤ブロックを素手で右クリック（魔力不要）。
2.  **パターン認識**: 魔法陣の構成を自動スキャンし、魔力消費量を計算。
3.  **ブロック破壊**: 構成する全てのシンボルブロックが破壊されます。
4.  **エンティティ魔法陣生成**: 対応するエンティティによる魔法陣が出現。
5.  **アイテム受付**（分解・加工モードのみ）: 60秒間、魔法陣中央に投下されたアイテムを受け付けます。
6.  **魔力消費**: プレイヤーの保有魔力を可能な限り消費（不足していても実行）。
7.  **効果発動判定**:
      * 魔力不足: 効果発動失敗（魔力は消費済み）。
      * 魔力十分: 魔法効果を発動。
8.  **効果実行**: 全条件が揃った場合のみ魔法効果を実行。

### 魔力不足時の動作

  * **魔力不足**:
      * 魔法陣は常に起動可能ですが、保有魔力は全て消費され、効果発動は失敗します。
      * メッセージ: `"魔力不足により効果発動に失敗しました"`

### エラーハンドリングメッセージ

  * クールダウン中: `"魔法陣はまだ使用できません (残りX秒)"`
  * 魔力不足: `"魔力不足により効果発動に失敗しました"`

### 4.4 魔法の例 (モード明示)

### 1\. 分解モード（分）: アイテム → 魔力変換

  * **機能**: アイテムを対応する属性の魔力に変換します。
  * **対象**: 分解する属性と同じ魔力を持つアイテムのみ。
      * 例: 火属性（木材、石炭）、水属性（氷、雪玉）、土属性（石、鉱石）、空属性（羽根、紙）。
  * **基準変換効率**: 研究テーブル10%、単一属性10%、2属性複合30%、3属性複合50%、4属性複合（奈落）80%。
  * **処理性能**: 属性シンボル数に依存し、同時受付数・処理速度が向上します。

### 2\. 発現モード（発）: 魔力 → エネルギーや現象

  * **機能**: 魔力を消費して様々な魔法効果を発生させます。
  * **発動方法別の効果**:
      * **ワンド右クリック**: 視線方向に効果を発射。
      * **ワンド左クリック**: 接触した対象に直接効果を適用。
      * **素手起動**: 魔法陣中央で周囲に範囲効果を発生。
      * **魔法出力装置**: 工業的・システム的な持続効果。
  * **効果の威力・範囲**: 魔法陣に記述された属性シンボルの数に依存。
  * **効果例**: 火（着火）、水（消火）、雷（電撃、電力生成200MF/s）、奈落（空間操作）。

### 3\. 加工モード（工）: アイテム＋魔力 → 加工品

  * **機能**: 物質シンボルで指定したアイテムを別のアイテムに変換します。
  * **変換方法**: 属性の組み合わせで加工方法が決定します。
      * 例: 火（高温精錬）、土（圧縮成形）、雷（電気分解）、生命（生体強化）。
  * **処理性能**: 属性シンボル数に依存し、同時受付数・加工速度が向上します。

### 4\. 工程連鎖: 複数モードを順次実行

  * 単一魔法陣内で複数のモードシンボルを配置すると自動的に発生します。
  * 例: 発現→分解の連鎖で、作物の収穫後に余剰を魔力化。

### 5\. 順次発現: 複数の発現を段階的実行

  * 発現シンボルを複数配置することで、段階的な効果発動が可能です（例: 1つ目で威力、2つ目で範囲を設定）。

### 強化ブロックの活用例 (単層・発現モード)

| 配置パターン | 属性 | 強化 | 効果倍率 | 総効果 | 魔力消費 | 効率 | スロット | 用途                               |
| :----------- | :--- | :--- | :------- | :----- | :------- | :--- | :------- | :--------------------------------- |
| **純粋配置** | 4水4空 | 0    | 1.0      | 雷×4  | 水4空4+発現3=11 | 1.0  | 9        | 効率重視                             |
| **強化活用** | 2水2空 | 2    | 2.0      | 雷×4  | 水4空4+発現3=11 | 1.0  | 7        | スペース節約、魔力集中               |
| **ハイブリッド** | 3水3空 | 1    | 1.5      | 雷×4.5 | 水4.5空4.5+発現3=12 | 0.94 | 8        | 高効果かつバランスの良い配置       |

### 複合効果ボーナスの例

  * **単一属性（火×8）**: ダメージ = $8 \\times 0.75 \\times 1.0 = 6$
  * **2種複合（雷：水4+空4）**: ダメージ = $4 \\times 0.75 \\times 1.25 = 3.75$
  * **3種複合（ネザー：火6+空6+土6）**: ダメージ = $6 \\times 0.75 \\times 1.5 = 6.75$
  * **4種複合（奈落：火8+水8+空8+土8）**: ダメージ = $8 \\times 0.75 \\times 2.0 = 12$

*注: 三重・四重構成の魔法陣は、魔力タンクを装備していないと実行できません。*

-----

## 5\. UI/UX

### 5.1 魔力表示

カスタムUIゲージが画面下部に表示され、4属性の魔力量を視覚的に表現します。

  * **表示要素**: 背景画像、属性別ゲージ画像、枠画像、現在値/最大値の数値テキスト。
  * **実装技術**: JSON UIによるレイアウト、UV座標/size属性での画像拡縮、ダイナミックプロパティとのデータバインディング、スムーズな増減アニメーション。

### 5.2 魔法陣の直接起動

  * **操作**: 魔法陣の**始点シンボルを素手で右クリック**します。
  * **魔力消費**: プレイヤーの体内魔力を直接消費します。
  * **起動制限**:
      * **魔力完全不足**: 魔力が0の場合は起動不可。
      * **魔力不足**: 魔力不足でも起動しますが、効果は減衰し、保有魔力は全消費されます。
      * **クールダウン**: 同じ魔法陣の連続使用には5秒のクールダウンがあります。

-----

## 6\. バランス設計

### 6.1 戦闘ダメージ計算式

  * **基本式**: `$ダメージ = 複合後の属性数 \times 0.75 \times 複合ボーナス$`
  * **複合ボーナス**:
      * 単一属性: 1.0倍
      * 2種複合: 1.25倍
      * 3種複合: 1.5倍
      * 4種複合: 2.0倍
  * **強化による増加**: 強化後の属性数で計算されます。

### 6.2 制限事項

  * 基本魔力容量は100ポイントに固定。
  * 同じ魔法陣の連続使用にはクールダウンペナルティがあります。

### 6.3 魔力回復作物システム

魔力回復作物システムは、生命と繁茂の加工魔法陣を利用して、魔力を即座に回復できる作物を栽培するシステムです。

#### 基本魔力回復作物（生命属性で生成）
- **生成方法**: 生命（水+土）属性の加工魔法陣を使用
- **材料**: 既存の作物種×9 + 水バケツ×1
- **効果**: 各属性の魔力を+15回復する実が育つ種を3個生成

| 作物名 | 効果 | 材料 |
|--------|------|------|
| 火椒 | 火魔力+15回復 | 小麦の種×9 + 水バケツ×1 |
| 氷蓮 | 水魔力+15回復 | ジャガイモ×9 + 水バケツ×1 |
| 地根草 | 土魔力+15回復 | ニンジンの種×9 + 水バケツ×1 |
| 風花 | 空魔力+15回復 | ビートルートの種×9 + 水バケツ×1 |

#### 上位魔力回復作物（繁茂属性で強化）
- **生成方法**: 繁茂（水+空+土）属性の加工魔法陣を使用
- **材料**: 基本魔力回復作物の種×3 + 濃縮魔力核×1
- **効果**: 各属性の魔力を+30回復する実が育つ種を1個生成

| 作物名 | 効果 | 材料 |
|--------|------|------|
| 紅火椒 | 火魔力+30回復 | 火椒の種×3 + 濃縮魔力核×1 |
| 蒼氷蓮 | 水魔力+30回復 | 氷蓮の種×3 + 濃縮魔力核×1 |
| 黄金地根草 | 土魔力+30回復 | 地根草の種×3 + 濃縮魔力核×1 |
| 銀風花 | 空魔力+30回復 | 風花の種×3 + 濃縮魔力核×1 |

#### 最上位魔力回復作物（奈落属性で究極強化）
- **生成方法**: 奈落（火+水+空+土）属性の加工魔法陣を使用
- **材料**: 上位魔力回復作物の種×5 + 奈落魔力結晶×1
- **効果**: 各属性の魔力を+50回復する実が育つ種を1個生成

| 作物名 | 効果 | 材料 |
|--------|------|------|
| 神火椒 | 火魔力+50回復 | 紅火椒の種×5 + 奈落魔力結晶×1 |
| 深淵氷蓮 | 水魔力+50回復 | 蒼氷蓮の種×5 + 奈落魔力結晶×1 |
| 創世地根草 | 土魔力+50回復 | 黄金地根草の種×5 + 奈落魔力結晶×1 |
| 虚空風花 | 空魔力+50回復 | 銀風花の種×5 + 奈落魔力結晶×1 |

#### 利用方法
1. 生命属性の加工魔法陣で基本種を作成
2. 通常のMinecraftの栽培システムで栽培
3. 成長した作物から実を収穫
4. 実を消費して対応する属性の魔力を即座に回復
5. 繁茂属性の加工魔法陣で基本種から上位種を作成可能
6. 奈落属性の加工魔法陣で上位種から最上位種を作成可能（究極レベル）

このシステムにより、魔力不足を解消し、より高レベルの魔法を継続的に使用できるようになります。3段階のアップグレード構造により、ゲーム進行に応じて魔力回復効率を向上させることができます。

### 6.4 成長要素

  * 魔力タンクのアップグレード。
  * 研究による新しい魔法陣パターンの発見。
  * 魔力効率を上げるエンチャント。

-----

## 7\. 将来の拡張

### 7.1 計画中の機能

  * 魔力変換システム（属性間の変換）。
  * 魔力ネットワーク（プレイヤー間での共有）。
  * 儀式魔法（複数プレイヤーでの協力魔法）。

### 7.2 コンテンツ拡張

  * 新しい魔法陣パターン。
  * 特殊な効果を持つ魔力タンク。
  * 環境と連動した魔力獲得ボーナス。

-----

## 8\. データ化魔法陣システム

### 8.1 概要

構築した魔法陣を専用ブロック「魔法陣基盤ブロック」上で魔法陣解析装置を使ってデータカードに保存するシステムです。

### 8.2 必要要素

  * **魔法陣基盤ブロック**: 魔法陣を構築する土台。
  * **魔法陣解析装置**: 構築されたパターンを読み取る機械。段階に応じて解析可能な魔法陣の複雑さが向上。
  * **データカード (Lv.1-4)**:
      * Lv.1: 単層のみ保存可能
      * Lv.2: 二重まで保存可能
      * Lv.3: 三重まで保存可能
      * Lv.4: 四重まで保存可能

### 8.3 プロセス

1.  魔法陣基盤ブロックを円形に配置。
2.  その上にチョークで魔法陣を記述。
3.  魔法陣解析装置にパターン名を入力。
4.  電力を消費してスキャンを実行（段階により消費電力が異なる）。
5.  名前付きデータカードに魔法陣データが保存されます。

### 8.4 活用方法

  * **魔法陣プリンター**: データカードから魔法陣を自動構築。
  * **パターンライブラリ**: 魔法陣データの保管・検索。
  * **取引**: データカードの交換・売買。

### 8.5 データ化魔法陣の使用方法

データカード化された魔法陣は、ワンドや魔法出力装置で使用できます。

### 1\. ワンドによる使用

  * **登録数**: 3つまで。
  * **操作方法**:
      * データカード＋右クリック: ワンドに魔法陣を登録。
      * Shift+右クリック: 登録済み魔法陣を切り替え。
      * 右クリック: 発現系は視線方向に発射、加工・分解系は対象ブロックに適用。
  * **リソース**: プレイヤーの魔力とインベントリ内のアイテムを消費。

### 2\. 魔法出力装置による使用

  * **登録数**: レベルに応じて1～4つまで（Lv.1=1つ、Lv.2=2つ、Lv.3=3つ、Lv.4=4つ）。
  * **起動条件**: 電力供給で自動起動。
  * **必要リソース**: 電力（起動用）、魔力（魔力パイプから供給）、要求アイテム。
  * **出力**: 発電や魔力生成、発現系魔法は周囲に効果を発揮。
  * **連鎖処理**: 登録数の範囲内で複数の魔法陣を順次実行可能。

-----

## 9\. 魔法陣外部連結システム

### 9.1 概要

複数の魔法陣サークルを物理的に接続し、大規模な魔術システムを構築できる機能です。

**用語整理**:

  * **魔法陣接続**: 複数の魔法陣サークル同士の物理的接続。
  * **工程連鎖**: 単一魔法陣内での複数モードの順次実行。
  * **順次発現**: 単一魔法陣内での複数発現の段階的実行。

### 9.2 接続可能な構成 (実装パターン)

  * **基本接続**: 二重 + 単層、三重 + 二重、四重 + 二重。
  * **複合接続**: 三重 + 二重 + 単層（複数）、四重 + 二重 + 単層（複数）。

**接続構造例**:

```
      単層
        ↑
四層→二層→単層
        ↓
      単層
```

### 9.3 シンボル定義

  * **s (start)**: メインサークルの始動点（1つのみ）。
  * **r (relay)**: 接続ポイント（複数設置可能）。
  * **z**: 通常のサークル構成要素（基、属性ブロック等）。

### 9.4 基本連結パターン

図はメインサークルと連結サークルの物理的な配置とシンボルを示しています。`s`は始点、`r`は連結ポイントです。

### 三重 + 二重連結

```
メインサークル（3層）
      zzzzz      
    zz     zz    
   z         z   連結サークル（2層）
  z    zzz    z         zzz
 z   zz   zz   z      zz   zz
 z  z       z  z     z       z
z   z  zzz  z   z    z  zzz  z
z  z  z   z  z  z   z  z   z  z
z  z  z b s  s  srrrrrrr   z  z
z  z  z   z  z  z   z  z   z  z
z   z  zzr  z   z    z  zzz  z
 z  z       z  z     z       z
 z   zz   zz   z      zz   zz
  z    zzz    z         zzz
   z         z   
    zz     zz    
      zzzzz      
```

### 四重 + 二重連結

```
メインサークル（4層）
         zzzzzzz         
       zz       zz       
     zz           zz     
    z               z    
   z      zzzzz      z   
  z     zz     zz     z  
  z    z         z    z  連結サークル（2層）
 z    z    zzz    z    z        zzz
 z   z   zz   zz   z   z      zz   zz
z    z  z       z  z    z    z       z
z   z  z   zzz  z   z   z    z  zzz  z
z   z  z  z   z  z  z   z   z  z   z  z
z   z  z  z b s  s  s   srrrrrrr   z  z
z   z  z  z   z  z  z   z   z  z   z  z
z   z  z   zzz  z   z   z    z  zzz  z
z    z  z       z  z    z    z       z
 z   z   zz   zz   z   z      zz   zz
 z    z    zzz    z    z        zzz
  z    z         z    z  
  z     zz     zz     z  
   z      zzzzz      z   
    z               z    
     zz           zz     
       zz       zz       
         zzzzzzz  
```
### **三重 + 二重 + 単層複合連結**
```
メインサークル（3層）
      zzzzz      
    zz     zz    
   z         z   連結サークル（2層）
  z    zzz    z         zzz
 z   zz   zz   z      zz   zz
 z  z       z  z     z       z
z   z  zzz  z   z    z  zzz  z
z  z  z   z  z  z   z  z   z  z
z  z  z b s  s  srrrrrrr   z  z
z  z  z   z  z  z   z  z   z  z
z   z  zzr  z   z    z  zrz  z
 z  z       z  z     z   r   z
 z   zz   zz   z      zz r zz
  z    zzz    z         zrz
   z         z           r
    zz     zz            r
      zzzzz              r   連結サークル2（1層）
                        zrz
                       z   z
                       z   z
                       z   z
                        zzz
```

### **四重 + 二重 + 単層複合連結**
```
メインサークル（4層）
         zzzzzzz         
       zz       zz       
     zz           zz     
    z               z    
   z      zzzzz      z   
  z     zz     zz     z  
  z    z         z    z  連結サークル（2層）
 z    z    zzz    z    z        zzz
 z   z   zz   zz   z   z      zz   zz
z    z  z       z  z    z    z       z
z   z  z   zzz  z   z   z    z  zzz  z
z   z  z  z   z  z  z   z   z  z   z  z
z   z  z  z b s  s  s   srrrrrrr   z  z
z   z  z  z   z  z  z   z   z  z   z  z
z   z  z   zzz  z   z   z    z  zrz  z
z    z  z       z  z    z    z   r   z
 z   z   zz   zz   z   z      zz r zz
 z    z    zzz    z    z        zrz
  z    z         z    z          r
  z     zz     zz     z          r
   z      zzzzz      z           r   連結サークル2（1層）
    z               z           zrz
     zz           zz           z   z
       zz       zz             z   z
         zzzzzzz               z   z
                                zzz
```

### **二重 + 単層連結**
```
メインサークル（2層）
    zzz    
  zz   zz  
 z       z 連結サークル（1層）
 z  zzz  z     zzz
z  z   z  z   z   z
z  z b s  srrrr   z
z  z   z  z   z   z
 z  zzz  z     zzz
 z       z 
  zz   zz  
    zzz    
```

### 9.5 接続ルール

  * **メインサークル（上位レベル）**:
      * 必須要素: 1つの`s`シンボルと1セットの`r`シンボル（3個）。
      * 接続制限: 1つの接続サークルにのみ接続可能。
      * 配置制約: `s`と`r`は同一サークル内に配置します。
  * **接続先サークル（接続仕様）**:
      * 始動点: `s`の代わりに`r`シンボルを1つ使用します。
      * 接続方向: 特定の方向でメインサークルの`rrr`と接続します。
      * 多重接続: 接続サークルから最大3つの次レベルサークルに接続可能（各方向1つずつ配置可能）。
      * 物理的隣接: メインの`rrr`のうち1個と接続先の`r`が物理的に隣接する必要があります。

### 9.6 接続制約

  * **接続シンボル**: 接続には必ず3個の接続シンボル（`rrr`）が必要です。それ以上でもそれ以下でも接続は成立しません。
  * **距離制限**:
      * 二重 + 単層: 最大32ブロック以内。
      * 三重 + 二重: 最大48ブロック以内。
      * 四重 + 二重: 最大56ブロック以内。
      * 複合接続では、各連結段階で上記の距離制限が適用されます。
  * **配置ルール**:
      * 連結シンボル3個セット（`rrr`）は、メインサークルの最外層に隙間なく直線に配置します。
      * 連結先サークルの`r`シンボルは、メインの`rrr`の端の1個と物理的に隣接するように配置します。

### 9.7 パワー共有システム

連結された魔法陣は、各サークルのパワーを個別に計算し、単純に合計します。連結によるボーナスやデメリットはありません。

  * **計算方式**: `$totalPower = mainCircle.power + connectedCircles.sum(power)$`

      * 各サークルは個別のレベル倍率（単層×1、二重×3、三重×6、四重×10）が適用されます。
      * 例: 二重 + 単層の場合: `mainPower = 二重サークル属性数 × 3倍`、`connectedPower = 単層サークル属性数 × 1倍`。`finalEffect = mainPower + connectedPower`。

  * **処理順序**: 魔法陣発動時の処理は以下の順序で実行され、効果が統合されます。

    1.  メインサークル
    2.  第1接続サークル
    3.  第2接続サークル群（メインとの接続部分を基準点とし、時計回りに処理）

### 9.8 使用例

  * **基本接続（三重 + 二重）**:

      * メインサークル（三重）: 火20、水20
      * 接続サークル（二重）: 火8、水8
      * 総消費: 火424、水424
      * 総効果: 火212、水212（蒸気効果）

  * **複合接続（三重 + 二重 + 単層×3）**:

      * メインサークル（三重）: 火20、水20
      * 接続二重: 火8、水8
      * 接続単層×3: 各火2、水2
      * 総消費: 任意72、火436、水436
      * 総効果: 火218、水218（蒸気効果）

-----

## 10\. 技術仕様

### 10.1 データ保存

  * プレイヤー魔力: ダイナミックプロパティ。
  * 魔法陣データ: アイテムNBTタグ（JSON形式）として保存されます。
  * パターン情報: 座標とブロック種別を記録。
  * 連結情報: メインと連結先の関係マッピング。

### 10.2 パフォーマンス

  * 魔法陣認識: チャンク読み込み時にキャッシュ。
  * 魔力更新: 20tickごとにバッチ処理。
  * スキャン処理: サイズに応じた段階的処理。
  * 連結チェック: 魔法陣使用時のみ実行。

### 10.3 互換性

  * Minecraft統合版 1.21.59以降に対応。
  * Script API v1.18.0を使用。

-----



### 11 インターフェース

#### 魔力ゲージUI
- **説明**: 画面下部に表示される4属性の魔力量表示
- **要素**:
  - 火属性ゲージ（赤）
  - 水属性ゲージ（青）
  - 土属性ゲージ（橙）
  - 空属性ゲージ（緑）
  - 現在値/最大値の数値表示